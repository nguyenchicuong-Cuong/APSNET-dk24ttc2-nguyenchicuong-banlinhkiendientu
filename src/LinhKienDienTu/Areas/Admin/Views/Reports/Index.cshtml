@{
    ViewData["Title"] = "Báo cáo & Thống kê";
}

<h2 class="mb-4 text-white">Báo cáo & Thống kê</h2>

<!-- Revenue Cards -->
<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="glass-card p-3 text-center">
            <h6 class="text-muted mb-2">Doanh thu hôm nay</h6>
            <h3 class="text-gradient fw-bold mb-0">@ViewBag.TodayRevenue.ToString("N0") ₫</h3>
            <small class="text-muted">@ViewBag.TodayOrders đơn hàng</small>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="glass-card p-3 text-center">
            <h6 class="text-muted mb-2">Doanh thu tháng này</h6>
            <h3 class="text-gradient fw-bold mb-0">@ViewBag.MonthRevenue.ToString("N0") ₫</h3>
            <small class="text-muted">@ViewBag.MonthOrders đơn hàng</small>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="glass-card p-3 text-center">
            <h6 class="text-muted mb-2">Doanh thu năm nay</h6>
            <h3 class="text-gradient fw-bold mb-0">@ViewBag.YearRevenue.ToString("N0") ₫</h3>
            <small class="text-muted">@ViewBag.YearOrders đơn hàng</small>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="glass-card p-3 text-center">
            <h6 class="text-muted mb-2">Tổng doanh thu</h6>
            <h3 class="text-gradient fw-bold mb-0">@ViewBag.TotalRevenue.ToString("N0") ₫</h3>
            <small class="text-muted">@ViewBag.TotalOrders đơn hàng</small>
        </div>
    </div>
</div>

<!-- Summary Cards -->
<div class="row mb-4">
    <div class="col-md-4 mb-3">
        <div class="glass-card p-3 text-center">
            <i class="fa-solid fa-users fa-3x text-info mb-2"></i>
            <h4 class="text-white fw-bold">@ViewBag.TotalCustomers</h4>
            <p class="text-muted mb-0">Tổng khách hàng</p>
        </div>
    </div>
    <div class="col-md-4 mb-3">
        <div class="glass-card p-3 text-center">
            <i class="fa-solid fa-box fa-3x text-warning mb-2"></i>
            <h4 class="text-white fw-bold">@ViewBag.TotalProducts</h4>
            <p class="text-muted mb-0">Tổng sản phẩm</p>
        </div>
    </div>
    <div class="col-md-4 mb-3">
        <div class="glass-card p-3 text-center">
            <i class="fa-solid fa-clipboard-list fa-3x text-success mb-2"></i>
            <h4 class="text-white fw-bold">@ViewBag.TotalOrders</h4>
            <p class="text-muted mb-0">Tổng đơn hàng</p>
        </div>
    </div>
</div>

<div class="row">
    <!-- Top Selling Products -->
    <div class="col-md-6 mb-4">
        <div class="glass-card p-4">
            <h4 class="mb-3 border-bottom border-secondary pb-2">
                <i class="fa-solid fa-fire text-danger me-2"></i>Sản phẩm bán chạy
            </h4>
            <div class="table-responsive">
                <table class="table table-dark table-sm">
                    <thead>
                        <tr>
                            <th>Sản phẩm</th>
                            <th class="text-end">Đã bán</th>
                            <th class="text-end">Doanh thu</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in ViewBag.TopProducts)
                        {
                            <tr>
                                <td>@item.Product.Name</td>
                                <td class="text-end"><span class="badge bg-info">@item.TotalQuantity</span></td>
                                <td class="text-end text-gradient fw-bold">@item.TotalRevenue.ToString("N0") ₫</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Low Stock Products -->
    <div class="col-md-6 mb-4">
        <div class="glass-card p-4">
            <h4 class="mb-3 border-bottom border-secondary pb-2">
                <i class="fa-solid fa-triangle-exclamation text-warning me-2"></i>Sản phẩm sắp hết hàng
            </h4>
            <div class="table-responsive">
                <table class="table table-dark table-sm">
                    <thead>
                        <tr>
                            <th>Sản phẩm</th>
                            <th>Mã SP</th>
                            <th class="text-end">Tồn kho</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var product in ViewBag.LowStockProducts)
                        {
                            <tr>
                                <td>@product.Name</td>
                                <td>@product.PartNumber</td>
                                <td class="text-end">
                                    <span class="badge @(product.StockQuantity == 0 ? "bg-danger" : "bg-warning text-dark")">
                                        @product.StockQuantity
                                    </span>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Recent Orders -->
<div class="row">
    <div class="col-md-12 mb-4">
        <div class="glass-card p-4">
            <h4 class="mb-3 border-bottom border-secondary pb-2">
                <i class="fa-solid fa-clock text-primary me-2"></i>Đơn hàng gần đây
            </h4>
            <div class="table-responsive">
                <table class="table table-dark table-hover">
                    <thead>
                        <tr>
                            <th>Mã ĐH</th>
                            <th>Khách hàng</th>
                            <th>Ngày đặt</th>
                            <th>Tổng tiền</th>
                            <th>Trạng thái</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var order in ViewBag.RecentOrders)
                        {
                            <tr>
                                <td>
                                    <a asp-controller="OrderManager" asp-action="Details" asp-route-id="@order.Id" class="text-info text-decoration-none">
                                        #@order.Id
                                    </a>
                                </td>
                                <td>@order.CustomerName</td>
                                <td>@order.OrderDate.ToString("dd/MM/yyyy HH:mm")</td>
                                <td class="text-gradient fw-bold">@order.TotalAmount.ToString("N0") ₫</td>
                                <td>
                                    @switch (order.Status)
                                    {
                                        case LinhKienDienTu.Models.OrderStatus.Pending:
                                            <span class="badge bg-warning text-dark">Chờ xử lý</span>
                                            break;
                                        case LinhKienDienTu.Models.OrderStatus.Processing:
                                            <span class="badge bg-info text-dark">Đang xử lý</span>
                                            break;
                                        case LinhKienDienTu.Models.OrderStatus.Shipping:
                                            <span class="badge bg-primary">Đang giao</span>
                                            break;
                                        case LinhKienDienTu.Models.OrderStatus.Delivered:
                                            <span class="badge bg-success">Đã giao</span>
                                            break;
                                        case LinhKienDienTu.Models.OrderStatus.Cancelled:
                                            <span class="badge bg-danger">Đã hủy</span>
                                            break;
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
