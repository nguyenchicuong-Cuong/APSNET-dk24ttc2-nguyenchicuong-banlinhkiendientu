@model LinhKienDienTu.Models.Product

@{
    ViewData["Title"] = Model.Name;
}

<div class="container mt-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb glass-card px-3 py-2">
            <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index" class="text-decoration-none text-light">Trang chủ</a></li>
            <li class="breadcrumb-item"><a asp-controller="Product" asp-action="Index" class="text-decoration-none text-light">Sản phẩm</a></li>
            <li class="breadcrumb-item active text-muted" aria-current="page">@Model.Name</li>
        </ol>
    </nav>

    <div class="row">
        <!-- Product Image -->
        <div class="col-md-5 mb-4">
            <div class="glass-card p-4 text-center h-100 d-flex align-items-center justify-content-center">
                <div class="bg-white rounded-3 p-5 w-100">
                    <i class="fa-solid fa-microchip fa-10x text-secondary"></i>
                </div>
            </div>
        </div>

        <!-- Product Info -->
        <div class="col-md-7">
            <div class="glass-card h-100 p-4">
                <h1 class="display-6 fw-bold mb-2">@Model.Name</h1>
                <div class="d-flex align-items-center mb-3">
                    <span class="badge bg-primary me-2">@Model.Category?.Name</span>
                    <span class="text-muted">Mã SP: @Model.PartNumber</span>
                </div>

                <div class="mb-4">
                    <h2 class="text-gradient fw-bold mb-0">@Model.Price.ToString("N0") ₫</h2>
                    @if (Model.BulkPrice.HasValue)
                    {
                        <small class="text-info"><i class="fa-solid fa-tags me-1"></i>Mua > 100 cái: @Model.BulkPrice.Value.ToString("N0") ₫/cái</small>
                    }
                </div>

                <div class="mb-4">
                    <h5>Mô tả:</h5>
                    <p class="opacity-75">@Model.Description</p>
                </div>

                <div class="mb-4">
                    <h5>Thông số kỹ thuật:</h5>
                    <div class="bg-dark bg-opacity-50 p-3 rounded-3">
                        <p class="mb-1"><strong>Nhà sản xuất:</strong> @Model.Manufacturer</p>
                        <p class="mb-0"><strong>Tồn kho:</strong> @Model.StockQuantity</p>
                        <!-- Add more specs here if available -->
                    </div>
                </div>

                <form asp-controller="Cart" asp-action="AddToCart" method="post" class="d-flex gap-3 mt-auto">
                    <input type="hidden" name="productId" value="@Model.Id" />
                    <div class="input-group" style="width: 140px;">
                        <button class="btn btn-outline-light btn-minus" type="button">-</button>
                        <input type="number" name="quantity" id="quantity-input" class="form-control text-center glass-input" value="1" min="1" aria-label="Quantity">
                        <button class="btn btn-outline-light btn-plus" type="button">+</button>
                    </div>
                    <button type="submit" class="btn btn-primary btn-lg flex-grow-1 rounded-pill">
                        <i class="fa-solid fa-cart-plus me-2"></i>Thêm vào giỏ hàng
                    </button>
                </form>
                
                @if (!string.IsNullOrEmpty(Model.DatasheetUrl))
                {
                    <div class="mt-4 pt-3 border-top border-secondary">
                        <a href="@Model.DatasheetUrl" target="_blank" class="btn btn-outline-info btn-sm">
                            <i class="fa-solid fa-file-pdf me-2"></i>Tải Datasheet
                        </a>
                    </div>
                }
            </div>
        </div>
    </div>

    <!-- Reviews Section -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="glass-card p-4">
                <h3 class="mb-4 border-bottom border-secondary pb-2">Đánh giá sản phẩm</h3>
                
                @if (User.Identity.IsAuthenticated)
                {
                    <div class="mb-5">
                        <h5>Viết đánh giá của bạn</h5>
                        <form asp-action="AddReview" method="post">
                            <input type="hidden" name="productId" value="@Model.Id" />
                            <div class="mb-3">
                                <label class="form-label text-light">Đánh giá:</label>
                                <div class="rating">
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="rating" value="5" id="r5" checked>
                                        <label class="form-check-label text-warning" for="r5"><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i></label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="rating" value="4" id="r4">
                                        <label class="form-check-label text-warning" for="r4"><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i></label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="rating" value="3" id="r3">
                                        <label class="form-check-label text-warning" for="r3"><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i></label>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light">Nhận xét:</label>
                                <textarea name="comment" class="form-control glass-input" rows="3" required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary rounded-pill">Gửi đánh giá</button>
                        </form>
                    </div>
                }
                else
                {
                    <div class="alert alert-info glass-card border-0">
                        Vui lòng <a asp-controller="Account" asp-action="Login" class="alert-link">đăng nhập</a> để viết đánh giá.
                    </div>
                }

                <div class="reviews-list">
                    @if (ViewBag.Reviews != null)
                    {
                        foreach (var review in ViewBag.Reviews)
                        {
                            <div class="review-item mb-3 pb-3 border-bottom border-secondary">
                                <div class="d-flex justify-content-between">
                                    <h6 class="fw-bold">@review.UserName</h6>
                                    <small class="text-muted">@review.ReviewDate.ToString("dd/MM/yyyy")</small>
                                </div>
                                <div class="text-warning mb-2">
                                    @for (int i = 0; i < review.Rating; i++)
                                    {
                                        <i class="fa-solid fa-star"></i>
                                    }
                                </div>
                                <p class="mb-0 opacity-75">@review.Comment</p>
                            </div>
                        }
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const minusBtn = document.querySelector('.btn-minus');
        const plusBtn = document.querySelector('.btn-plus');
        const input = document.getElementById('quantity-input');

        if(minusBtn && plusBtn && input) {
            minusBtn.addEventListener('click', () => {
                let val = parseInt(input.value) || 1;
                if (val > 1) input.value = val - 1;
            });

            plusBtn.addEventListener('click', () => {
                let val = parseInt(input.value) || 1;
                input.value = val + 1;
            });
        }
    });
</script>
